> :warning: _**Warning:** This project is under development and not yet stable._

# tillerless-helm-release-exporter
Helm (both v2 and v3) exporter which collects information directly from [Release](https://helm.sh/docs/glossary/#release)'s ConfigMap or Secret storage backend without the need for a running Tiller component.

[![License](https://img.shields.io/badge/License-Apache%202.0-blue.svg)](https://opensource.org/licenses/Apache-2.0)
[![CII Best Practices](https://bestpractices.coreinfrastructure.org/projects/3276/badge)](https://bestpractices.coreinfrastructure.org/projects/3276)
[![Build Status](https://travis-ci.com/bergerx/tillerless-helm-release-exporter.svg?branch=master)](https://travis-ci.com/bergerx/tillerless-helm-release-exporter)
[![FOSSA Status](https://app.fossa.io/api/projects/git%2Bgithub.com%2Fbergerx%2Ftillerless-helm-release-exporter.svg?type=shield)](https://app.fossa.io/projects/git%2Bgithub.com%2Fbergerx%2Ftillerless-helm-release-exporter?ref=badge_shield)
[![](https://images.microbadger.com/badges/image/bergerx/tillerless-helm-release-exporter.svg)](https://microbadger.com/images/bergerx/tillerless-helm-release-exporter "Get your own image badge on microbadger.com")
[![Docker pulls](https://img.shields.io/docker/pulls/bergerx/tillerless-helm-release-exporter.svg)](https://hub.docker.com/r/bergerx/tillerless-helm-release-exporter/)
[![Go Report Card](https://goreportcard.com/badge/github.com/bergerx/tillerless-helm-release-exporter)](https://goreportcard.com/report/github.com/bergerx/tillerless-helm-release-exporter)

Collects metrics for Releases which are:
* deployed with Helm v2 with Tiller,
* in any Namespaces in the Kubernetes cluster indepdendently from where the Tiller is running,
* deployed with Helm v2 without in-cluster Tiller (e.g. [Tillerless Helm](https://github.com/rimusz/helm-tiller)),
* deployed with Helm v3

Doesn't collect metrics for Releases which are:
* deployed with `helm template ... | kubectl apply -f -` (e.g. [Istio Install with Helm, Option 1](https://istio.io/docs/setup/install/helm/#option-1-install-with-helm-via-helm-template)). Since these are not really [Helm Release](https://helm.sh/docs/glossary/#release)s, they are not stored in either ConfigMap or a Secret backend.

# Installing the Chart

The charts are generated by [Travis
CI](https://github.com/bergerx/tillerless-helm-release-exporter/blob/master/.travis.yml),
and stored and served by Github Pages from
[gh-pages](https://github.com/bergerx/tillerless-helm-release-exporter/tree/gh-pages)
branch.

Install using helm 2:

```bash
helm repo add bergerx-helm-exporter https://bergerx.github.io/tillerless-helm-release-exporter
helm install bergerx-helm-exporter/tillerless-helm-release-exporter
```

Install using helm 3:

```bash
helm repo add bergerx-helm-exporter https://bergerx.github.io/tillerless-helm-release-exporter
helm install helm-exporter bergerx-helm-exporter/tillerless-helm-release-exporter
```

Check [values.yaml](charts/tillerless-helm-release-exporter/values.yaml) for all helm parameters.

For deploying into a cluster with prometheus operator:

```bash
helm install bergerx-helm-exporter/tillerless-helm-release-exporter --set serviceMonitor.enabled=true
```

# Collected metrics
| Metric name | Metric type | Labels/tags | Value |
| --- | --- | --- | --- |
| helm_release_info | Gauge |• `release_namespace` <br> • `release_name` <br>  • `chart_name` <br> • `helm_version`=`v2` or `v3` <br> • `storage_driver`=`ConfigMap` or `Secret` | &lt;release-version&gt; |
| helm_release_chart_version | Gauge | • `release_namesmace` <br> • `release_name` <br> • `chart_version` <br> • `chart` This is actually a redundant field but kept for convenience (`<chart_name>-<chart_version>`). `helm list` used to use this format. | 1 |
| helm_release_status | Gauge | • `release_namesmace` <br> • `release_name` <br> • `release_status` Uses Helm 3 status names as default. Helm 2 status names are mapped to Helm 3 statuses (e.g. "uninstalled" instead of "DELETED") <br> | 1 |

# Example metrics
```
# HELP helm_release_info Helm Release Information
# TYPE helm_release_info gauge
helm_release_info{chart_name="cert-manager",helm_version="v2",release_name="cert-manager",release_namespace="cert-manager",storage_driver="ConfigMap"} 4
helm_release_info{chart_name="memcached",helm_version="v2",release_name="steely-walrus",release_namespace="test",storage_driver="ConfigMap"} 1
helm_release_info{chart_name="memcached",helm_version="v3",release_name="memc",release_namespace="test",storage_driver="Secret"} 1
helm_release_info{chart_name="nginx-ingress",helm_version="v2",release_name="ingress",release_namespace="kube-system",storage_driver="ConfigMap"} 4
helm_release_info{chart_name="oauth2-proxy",helm_version="v2",release_name="auth",release_namespace="oauth2-proxy",storage_driver="ConfigMap"} 4
helm_release_info{chart_name="prometheus-operator",helm_version="v2",release_name="prometheus-operator",release_namespace="monitoring",storage_driver="ConfigMap"} 17
helm_release_info{chart_name="tillerless-helm-release-exporter",helm_version="v2",release_name="helm-exporter",release_namespace="monitoring",storage_driver="ConfigMap"} 2

# HELP helm_release_chart_version Helm Release Chart Version
# TYPE helm_release_chart_version gauge
helm_release_chart_version{chart="cert-manager-v0.11.0",chart_version="v0.11.0",release_name="cert-manager",release_namespace="cert-manager"} 1
helm_release_chart_version{chart="memcached-3.0.17",chart_version="3.0.17",release_name="memc",release_namespace="test"} 1
helm_release_chart_version{chart="memcached-3.0.17",chart_version="3.0.17",release_name="steely-walrus",release_namespace="test"} 1
helm_release_chart_version{chart="nginx-ingress-1.25.0",chart_version="1.25.0",release_name="ingress",release_namespace="kube-system"} 1
helm_release_chart_version{chart="oauth2-proxy-1.2.0",chart_version="1.2.0",release_name="auth",release_namespace="oauth2-proxy"} 1
helm_release_chart_version{chart="prometheus-operator-7.4.0",chart_version="7.4.0",release_name="prometheus-operator",release_namespace="monitoring"} 1
helm_release_chart_version{chart="tillerless-helm-release-exporter-0.2.1",chart_version="0.2.1",release_name="helm-exporter",release_namespace="monitoring"} 1

# HELP helm_release_status Helm Release Status
# TYPE helm_release_status gauge
helm_release_status{release_name="auth",release_namespace="oauth2-proxy",release_status="deployed"} 1
helm_release_status{release_name="cert-manager",release_namespace="cert-manager",release_status="deployed"} 1
helm_release_status{release_name="helm-exporter",release_namespace="monitoring",release_status="deployed"} 1
helm_release_status{release_name="ingress",release_namespace="kube-system",release_status="deployed"} 1
helm_release_status{release_name="memc",release_namespace="test",release_status="deployed"} 1
helm_release_status{release_name="prometheus-operator",release_namespace="monitoring",release_status="deployed"} 1
helm_release_status{release_name="steely-walrus",release_namespace="test",release_status="deployed"} 1
```

# Why a new exporter
* Supports both Helm 2 and Helm 3 releases,
* Works without a Tiller (e.g. works even when you used `helm tiller` plugin, aka tillerless-helm),
* No need to deal with Tiller tls certs,
* Exports both chart and release name and versions in resulting metrics, chart version is significant to see the effective version, release version is actually a signal to annotate when the last Helm deployment is done,
* Release versions as the metric's value, so you can annotate release dates in grafana.

# Alternatives
* https://github.com/sstarcher/helm-exporter
* https://github.com/Kubedex/exporter


## License
[![FOSSA Status](https://app.fossa.io/api/projects/git%2Bgithub.com%2Fbergerx%2Ftillerless-helm-release-exporter.svg?type=large)](https://app.fossa.io/projects/git%2Bgithub.com%2Fbergerx%2Ftillerless-helm-release-exporter?ref=badge_large)
